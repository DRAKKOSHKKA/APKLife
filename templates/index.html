<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</title>
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>

		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='style.css') }}"
		/>
	</head>
	<body>
		<header>
			{% if group_info %}
			<div class="d-flex justify-content-between align-items-center">
				<a
					href="/?group_name={{ group_info.SearchString }}{% if prev_week_id is not none %}&week_id={{ prev_week_id }}{% endif %}"
					class="btn btn-sm btn-outline-light mx-2 {% if not prev_week_id %}disabled{% endif %}"
				>
					<i class="bi bi-chevron-left"></i>
				</a>
				<h4 class="m-0">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ {{ group_info.SearchString }}</h4>
				<a
					href="/?group_name={{ group_info.SearchString }}{% if next_week_id is not none %}&week_id={{ next_week_id }}{% endif %}"
					class="btn btn-sm btn-outline-light mx-2 {% if not next_week_id %}disabled{% endif %}"
				>
					<i class="bi bi-chevron-right"></i>
				</a>
			</div>
			<div class="day-nav d-flex justify-content-between flex-wrap mt-2 p-2">
				{% for day in days_list %}
				<a
					href="/?group_name={{ group_info.SearchString }}{% if week_id is not none %}&week_id={{ week_id }}{% endif %}&day={{ day.split(' ')[0] }}"
					class="btn btn-sm mb-1 {% if active_day and day.split(' ')[0] == active_day.split(' ')[0] %}btn-light text-primary fw-bold{% else %}btn-outline-light{% endif %}"
				>
					{{ day.split(" ")[1].split(".")[0] }}
				</a>
				{% endfor %}
			</div>
			{% else %}
			<h4 class="m-0">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h4>
			{% endif %}
		</header>

		<div class="container my-3 pb-5">
			{% if error %}
			<div class="alert alert-danger" role="alert">{{ error }}</div>
			{% elif corrected_name %}
			<div class="alert alert-info" role="alert">
				–ù–∞–π–¥–µ–Ω–∞ –ø–æ—Ö–æ–∂–∞—è –∑–∞–ø–∏—Å—å: <strong>{{ corrected_name }}</strong>
			</div>
			{% endif %} {% if not group_info %}
			<div class="card shadow-sm">
				<div class="card-body">
					<h5 class="card-title">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</h5>
					<form id="searchForm" method="get">
						<div class="mb-3 position-relative">
							<input
								type="text"
								class="form-control"
								id="group-input"
								name="group_name"
								placeholder="11 –Ω–º–æ, –ö–ª–∏–º–æ–≤–∞ –¢.–°., –∞–∫—Ç–æ–≤—ã–π –∑–∞–ª"
								autocomplete="on"
								<!--
								–ò–∑–º–µ–Ω–µ–Ω–æ
								—Å
								off
								–Ω–∞
								on
								--
							/>
							<div
								id="suggestions-container"
								class="list-group position-absolute w-100 z-100"
								style="display: none"
							></div>
						</div>
						<button type="submit" class="btn btn-primary w-100">
							–ù–∞–π—Ç–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
						</button>
					</form>
				</div>
			</div>
			{% else %} {% for day, lessons in schedule.items() %}
			<div class="card mb-3 shadow-sm">
				<div class="card-header bg-light">
					<h5 class="card-title mb-0">{{ day }}</h5>
				</div>
				<div class="card-body p-0">
					{% if lessons %}
					<ul class="list-group list-group-flush">
						{% for lesson_list in lessons %}
						<li
							class="list-group-item"
							style="background: transparent; border: none"
						>
							{% if lesson_list %} {% for lesson in lesson_list %}
							<div
								class="lesson {% if lesson_list|length > 1 %}multiple-lesson{% endif %} {% if not lesson.subject %}empty-lesson{% if '–°–±' in day or '–í—Å' in day %} weekend-empty{% endif %}{% endif %}"
							>
								<div class="lesson-content">
									{% if lesson.time %}
									<div class="time">
										<i class="bi bi-clock"></i>
										{% if lesson_list|length > 1 %}
										<small>–ß–∞—Å—Ç—å {{ loop.index }}:</small>
										{% endif %} {{ lesson.time }}
									</div>
									{% endif %} {% if lesson.subject %}
									<div class="subject">
										<i class="bi bi-book"></i> {{ lesson.subject }}
									</div>

									{% if lesson.teacher %}
									<div class="teacher">
										<i class="bi bi-person"></i> {{ lesson.teacher }}
									</div>
									{% endif %} {% if lesson.room %}
									<div class="room">
										<i class="bi bi-geo-alt"></i> {{ lesson.room }}
									</div>
									{% endif %} {% if lesson.group %}
									<div class="group">
										<i class="bi bi-people"></i> {{ lesson.group }}
									</div>
									{% endif %} {% else %}
									<div class="empty-lesson-content">
										<div class="empty-lesson-icon">
											<i class="bi bi-emoji-smile"></i>
										</div>
										<div class="empty-lesson-text">–ù–µ—Ç –ø–∞—Ä—ã</div>
										<div class="empty-lesson-subtext">–ú–æ–∂–Ω–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å</div>
									</div>
									{% endif %}
								</div>
							</div>
							{% if not loop.last %}
							<hr class="lesson-divider" />
							{% endif %} {% endfor %} {% endif %}
						</li>
						{% endfor %}
					</ul>
					{% else %}
					<div
						class="d-flex flex-column align-items-center justify-content-center p-5"
					>
						<span style="font-size: 3em">üèñÔ∏è</span>
						<p class="mt-3 fs-5 text-center">–í—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å</p>
						<small class="text-muted">–ü–∞—Ä –Ω–µ—Ç</small>
					</div>
					{% endif %}
				</div>
			</div>
			{% endfor %} {% if not schedule %}
			<div
				class="d-flex flex-column align-items-center justify-content-center p-5"
			>
				<span style="font-size: 3em">üéì</span>
				<p class="mt-3 fs-5 text-center">–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –ø–∞—Ä –Ω–µ—Ç</p>
				<small class="text-muted">–£—á–µ–±–Ω–∞—è –Ω–µ–¥–µ–ª—è –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞</small>
			</div>
			{% endif %} {% endif %}
		</div>

		<footer
			class="fixed-bottom navbar navbar-expand-lg navbar-light bg-light border-top"
		>
			<div class="container d-flex justify-content-around">
				{% if group_info %}
				<a class="nav-link text-center px-1 py-0" href="/">
					<i class="bi bi-x-circle d-block fs-5"></i>
					<span class="d-block" style="font-size: 0.75em">–°–±—Ä–æ—Å–∏—Ç—å</span>
				</a>
				{% endif %}
				<a
					class="nav-link text-center px-1 py-0"
					href="#"
					data-bs-toggle="modal"
					data-bs-target="#settingsModal"
				>
					<i class="bi bi-gear-fill d-block fs-5"></i>
					<span class="d-block" style="font-size: 0.75em">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
				</a>
				<a
					class="nav-link text-center px-1 py-0"
					href="#"
					data-bs-toggle="modal"
					data-bs-target="#infoModal"
				>
					<i class="bi bi-info-circle d-block fs-5"></i>
					<span class="d-block" style="font-size: 0.75em">–ò–Ω—Ñ–æ</span>
				</a>
			</div>
		</footer>

		<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
		<div
			class="modal fade"
			id="settingsModal"
			tabindex="-1"
			aria-labelledby="settingsModalLabel"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="settingsModalLabel">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<div class="form-check form-switch mb-3">
							<input
								class="form-check-input"
								type="checkbox"
								id="darkModeSwitch"
							/>
							<label class="form-check-label" for="darkModeSwitch"
								>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</label
							>
						</div>
						<!-- –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ -->
						<div class="form-check form-switch mb-3">
							<input
								class="form-check-input"
								type="checkbox"
								id="autoLoadSwitch"
								checked
							/>
							<label class="form-check-label" for="autoLoadSwitch"
								>–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≥—Ä—É–ø–ø—ã</label
							>
						</div>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>
							–ó–∞–∫—Ä—ã—Ç—å
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
		<div
			class="modal fade"
			id="infoModal"
			tabindex="-1"
			aria-labelledby="infoModalLabel"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="infoModalLabel">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<div class="text-center mb-3">
							<span style="font-size: 3em">üìÖ</span>
						</div>
						<h6>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ê–ü–ö</h6>
						<p>–í–µ—Ä—Å–∏—è 1.0.0</p>
						<p>
							–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:
							<a href="https://t.me/drakkoshkka">t.me/drakkoshkka</a>
						</p>
						<p>
							–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–Ω—è—Ç–∏–π
							–ê–ª—å–º–µ—Ç—å–µ–≤—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–ª–µ–¥–∂–∞. (–ê–ü–ö)
						</p>
						<p>
							–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Å–∞–π—Ç–∞:
							<a href="https://it-institut.ru/SearchString/Index/37"
								>it-institut.ru</a
							>
						</p>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>
							–ó–∞–∫—Ä—ã—Ç—å
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', function () {
				const groupInput = document.getElementById('group-input')
				const suggestionsContainer = document.getElementById(
					'suggestions-container'
				)
				const searchForm = document.getElementById('searchForm')
				const darkModeSwitch = document.getElementById('darkModeSwitch')
				const autoLoadSwitch = document.getElementById('autoLoadSwitch')
				const body = document.body

				let suggestions = []
				const isDarkMode = localStorage.getItem('darkMode') === 'true'
				// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —á—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage
				const autoLoad = localStorage.getItem('autoLoad') !== 'false'

				if (isDarkMode) {
					body.classList.add('dark-mode')
					darkModeSwitch.checked = true
				} else {
					body.classList.remove('dark-mode')
					darkModeSwitch.checked = false
				}

				if (autoLoadSwitch) {
					autoLoadSwitch.checked = autoLoad
				}

				// –î–æ–±–∞–≤–ª–µ–Ω–æ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏
				if (autoLoadSwitch) {
					autoLoadSwitch.addEventListener('change', function () {
						localStorage.setItem('autoLoad', this.checked)
					})
				}

				// –£–î–ê–õ–ï–ù–û: –∫–æ–¥ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É

				// –î–æ–±–∞–≤–ª–µ–Ω–æ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã
				if (groupInput) {
					groupInput.addEventListener('blur', function () {
						if (this.value.trim()) {
							localStorage.setItem('lastGroup', this.value.trim())
						}
					})
				}

				// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫
				if (searchForm) {
					searchForm.addEventListener('submit', function (e) {
						if (groupInput && groupInput.dataset.selectedSuggestion) {
							e.preventDefault()
							this.submit()
						}
					})
				}

				// –õ–æ–≥–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
				fetch('/suggestions.json')
					.then(response => response.json())
					.then(data => {
						suggestions = data
					})
					.catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫:', error))

				if (groupInput) {
					// –î–æ–±–∞–≤–ª–µ–Ω–æ: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ localStorage
					const lastInput = localStorage.getItem('lastInput')
					if (lastInput) {
						groupInput.value = lastInput
					}

					groupInput.addEventListener('input', function () {
						const inputValue = this.value.toLowerCase()
						// –î–æ–±–∞–≤–ª–µ–Ω–æ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
						localStorage.setItem('lastInput', this.value)

						if (inputValue.length > 0) {
							suggestionsContainer.style.display = 'block'
							suggestionsContainer.innerHTML = ''

							const filteredSuggestions = suggestions.filter(suggestion =>
								suggestion.name.toLowerCase().includes(inputValue)
							)

							if (filteredSuggestions.length > 10) {
								suggestionsContainer.classList.add(
									'suggestions-container-scrollable'
								)
							} else {
								suggestionsContainer.classList.remove(
									'suggestions-container-scrollable'
								)
							}

							filteredSuggestions.slice(0, 15).forEach(suggestion => {
								const item = document.createElement('a')
								item.classList.add('list-group-item', 'list-group-item-action')
								item.href = '#'

								let badgeColor = 'primary'
								if (suggestion.type === 'Teacher') {
									badgeColor = 'success'
								} else if (suggestion.type === 'Classroom') {
									badgeColor = 'info'
								}

								item.innerHTML = `${suggestion.name} <span class="badge rounded-pill bg-${badgeColor} badge-type">${suggestion.type}</span>`

								item.addEventListener('click', e => {
									e.preventDefault()
									groupInput.value = suggestion.name
									// –î–æ–±–∞–≤–ª–µ–Ω–æ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
									localStorage.setItem('lastInput', suggestion.name)
									localStorage.setItem('lastGroup', suggestion.name)
									groupInput.dataset.selectedSuggestion = 'true'
									suggestionsContainer.style.display = 'none'
									searchForm.submit()
								})
								suggestionsContainer.appendChild(item)
							})
						} else {
							suggestionsContainer.style.display = 'none'
						}
					})

					groupInput.addEventListener('blur', () => {
						setTimeout(() => {
							suggestionsContainer.style.display = 'none'
						}, 200)
					})

					groupInput.addEventListener('focus', () => {
						if (groupInput.value.length > 0) {
							suggestionsContainer.style.display = 'block'
						}
					})
				}

				// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
				document.addEventListener('click', e => {
					if (
						suggestionsContainer &&
						groupInput &&
						!suggestionsContainer.contains(e.target) &&
						e.target !== groupInput
					) {
						suggestionsContainer.style.display = 'none'
					}
				})

				// –î–æ–±–∞–≤–ª–µ–Ω–æ: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
				if (darkModeSwitch) {
					darkModeSwitch.addEventListener('change', function () {
						if (this.checked) {
							body.classList.add('dark-mode')
							localStorage.setItem('darkMode', 'true')
						} else {
							body.classList.remove('dark-mode')
							localStorage.setItem('darkMode', 'false')
						}
					})
				}
			})
		</script>
	</body>
</html>
